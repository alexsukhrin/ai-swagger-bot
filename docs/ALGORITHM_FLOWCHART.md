# 🔄 Діаграма процесу роботи AI Swagger Bot

## 📊 Загальна схема роботи

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                           AI SWAGGER BOT                                  │
│                        Повний алгоритм роботи                             │
└─────────────────────────────────────────────────────────────────────────────┘

                    ↓
┌─────────────────────────────────────────────────────────────────────────────┐
│                          1️⃣ ІНІЦІАЛІЗАЦІЯ                                 │
└─────────────────────────────────────────────────────────────────────────────┘

┌─────────────┐    ┌─────────────┐    ┌─────────────┐    ┌─────────────┐
│ Swagger     │───▶│ Swagger     │───▶│ RAG         │───▶│ LLM         │
│ File        │    │ Parser      │    │ Engine      │    │ Setup       │
└─────────────┘    └─────────────┘    └─────────────┘    └─────────────┘
                          ↓                    ↓                    ↓
                   ┌─────────────┐    ┌─────────────┐    ┌─────────────┐
                   │ Endpoints   │    │ Vector      │    │ OpenAI      │
                   │ Extraction  │    │ Database    │    │ Model       │
                   └─────────────┘    └─────────────┘    └─────────────┘

                    ↓
┌─────────────────────────────────────────────────────────────────────────────┐
│                          2️⃣ ОБРОБКА ЗАПИТУ                               │
└─────────────────────────────────────────────────────────────────────────────┘

┌─────────────┐    ┌─────────────┐    ┌─────────────┐    ┌─────────────┐
│ User        │───▶│ Intent      │───▶│ RAG         │───▶│ API         │
│ Query       │    │ Analysis    │    │ Search      │    │ Formation   │
└─────────────┘    └─────────────┘    └─────────────┘    └─────────────┘
                          ↓                    ↓                    ↓
                   ┌─────────────┐    ┌─────────────┐    ┌─────────────┐
                   │ Intent      │    │ Similar     │    │ API Request │
                   │ JSON        │    │ Endpoints   │    │ JSON        │
                   └─────────────┘    └─────────────┘    └─────────────┘

                    ↓
┌─────────────────────────────────────────────────────────────────────────────┐
│                          3️⃣ ВИКОНАННЯ API                                │
└─────────────────────────────────────────────────────────────────────────────┘

┌─────────────┐    ┌─────────────┐    ┌─────────────┐    ┌─────────────┐
│ API         │───▶│ HTTP        │───▶│ Response    │───▶│ Format      │
│ Request     │    │ Request     │    │ Processing  │    │ Response    │
└─────────────┘    └─────────────┘    └─────────────┘    └─────────────┘
                          ↓                    ↓                    ↓
                   ┌─────────────┐    ┌─────────────┐    ┌─────────────┐
                   │ JWT Auth    │    │ Status      │    │ User        │
                   │ Headers     │    │ Code        │    │ Output      │
                   └─────────────┘    └─────────────┘    └─────────────┘
```

## 🔄 Детальний процес обробки запиту

### Крок 1: Аналіз наміру
```
User Query: "Додай товар: синя сукня, розмір 22, кількість 10"
                    ↓
LLM Prompt: "Проаналізуй запит користувача та визначи намір та параметри..."
                    ↓
Intent JSON: {
    "intent": "create",
    "operation": "POST",
    "resource": "product",
    "parameters": {
        "name": "синя сукня",
        "size": "22",
        "quantity": "10"
    }
}
```

### Крок 2: Пошук endpoints
```
Intent + Query → RAG Search → Vector Database
                    ↓
Similar Endpoints: [
    {
        'content': 'Endpoint: POST /products\nSummary: Create a new product...',
        'metadata': {
            'method': 'POST',
            'path': '/products',
            'summary': 'Create a new product (Admin only)'
        }
    }
]
```

### Крок 3: Формування API запиту
```
Intent + Endpoints → LLM Prompt → API Request JSON
                    ↓
API Request: {
    "method": "POST",
    "url": "https://api.example.com/products",
    "headers": {"Content-Type": "application/json"},
    "data": {
        "name": "синя сукня",
        "size": "22",
        "quantity": 10
    }
}
```

### Крок 4: Виконання API виклику
```
API Request → HTTP Request → API Server → Response
                    ↓
Response: {
    "status_code": 201,
    "headers": {...},
    "data": {
        "id": 123,
        "name": "синя сукня",
        "size": "22",
        "quantity": 10,
        "created_at": "2025-08-07T13:50:17Z"
    }
}
```

### Крок 5: Форматування відповіді
```
Response → Format Function → User Output
                    ↓
📋 Сформований API запит:
🔗 URL: https://api.example.com/products
📤 Метод: POST
📦 Дані: {
  "name": "синя сукня",
  "size": "22",
  "quantity": 10
}

✅ Статус: 201
📥 Відповідь: {
  "id": 123,
  "name": "синя сукня",
  "size": "22",
  "quantity": 10,
  "created_at": "2025-08-07T13:50:17Z"
}
```

## 🏗️ Архітектурна діаграма

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                           КОРИСТУВАЧ                                      │
└─────────────────────────────────────────────────────────────────────────────┘
                                    ↓
┌─────────────────────────────────────────────────────────────────────────────┐
│                        ІНТЕРФЕЙСИ                                         │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐     │
│  │   CLI       │  │  Streamlit  │  │   Python    │  │    Web      │     │
│  │ Interface   │  │  Interface  │  │    API      │  │  Interface  │     │
│  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘     │
└─────────────────────────────────────────────────────────────────────────────┘
                                    ↓
┌─────────────────────────────────────────────────────────────────────────────┐
│                        SWAGGER AGENT                                      │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐     │
│  │ Intent      │  │ API         │  │ Response    │  │ Error       │     │
│  │ Analysis    │  │ Formation   │  │ Formatting  │  │ Handling    │     │
│  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘     │
└─────────────────────────────────────────────────────────────────────────────┘
                                    ↓
┌─────────────────────────────────────────────────────────────────────────────┐
│                        КОМПОНЕНТИ                                         │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐     │
│  │ Swagger     │  │ RAG         │  │ LLM         │  │ HTTP        │     │
│  │ Parser      │  │ Engine      │  │ Integration │  │ Client      │     │
│  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘     │
└─────────────────────────────────────────────────────────────────────────────┘
                                    ↓
┌─────────────────────────────────────────────────────────────────────────────┐
│                        ЗОВНІШНІ СЕРВІСИ                                  │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐     │
│  │ OpenAI      │  │ Chroma      │  │ Target      │  │ JWT         │     │
│  │ API         │  │ Database    │  │ API         │  │ Auth        │     │
│  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘     │
└─────────────────────────────────────────────────────────────────────────────┘
```

## 📊 Потоки даних

### Потік 1: Ініціалізація
```
Swagger File → Parser → Endpoints → RAG Engine → Vector DB
     ↓              ↓           ↓           ↓           ↓
  JSON/YAML    EndpointInfo  Chunks    Embeddings  Chroma DB
```

### Потік 2: Обробка запиту
```
User Query → Intent Analysis → RAG Search → API Formation → API Call → Response
     ↓              ↓              ↓              ↓            ↓         ↓
Natural Text    Intent JSON   Similar Docs   API Request   HTTP Req   Formatted
```

### Потік 3: Зберігання даних
```
Endpoints → Text Chunks → Embeddings → Vector DB → Persistence
     ↓            ↓            ↓           ↓           ↓
Metadata     Documents    Vectors     Indexes     SQLite/Binary
```

## ⚡ Продуктивність

### Час виконання:
- **Ініціалізація:** 2-3 секунди
- **Аналіз наміру:** 0.5-1 секунда
- **RAG пошук:** 0.1-0.3 секунди
- **API формування:** 0.5-1 секунда
- **HTTP запит:** 0.5-2 секунди
- **Форматування:** 0.1 секунда

### Загальний час: 1.6-7.4 секунди

## 🔧 Технічні деталі

### Векторна база:
- **Технологія:** Chroma DB
- **Розмір:** 6.0 MB
- **Документи:** 98
- **Індекси:** HNSW

### LLM:
- **Модель:** GPT-4/GPT-3.5-turbo
- **Температура:** 0
- **Контекст:** Swagger + Query

### API:
- **Таймаут:** 30 секунд
- **Авторизація:** JWT
- **Методи:** GET, POST, PUT, PATCH, DELETE
