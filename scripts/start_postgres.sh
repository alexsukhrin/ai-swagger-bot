#!/bin/bash

# –°–∫—Ä–∏–ø—Ç –¥–ª—è –∑–∞–ø—É—Å–∫—É PostgreSQL –±–∞–∑–∏ –¥–∞–Ω–∏—Ö

echo "üöÄ –ó–∞–ø—É—Å–∫ PostgreSQL –±–∞–∑–∏ –¥–∞–Ω–∏—Ö..."

# –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ —á–∏ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–π Docker
if ! command -v docker &> /dev/null; then
    echo "‚ùå Docker –Ω–µ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–π. –ë—É–¥—å –ª–∞—Å–∫–∞, –≤—Å—Ç–∞–Ω–æ–≤—ñ—Ç—å Docker."
    exit 1
fi

# –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ —á–∏ –∑–∞–ø—É—â–µ–Ω–∏–π Docker
if ! docker info &> /dev/null; then
    echo "‚ùå Docker –Ω–µ –∑–∞–ø—É—â–µ–Ω–∏–π. –ë—É–¥—å –ª–∞—Å–∫–∞, –∑–∞–ø—É—Å—Ç—ñ—Ç—å Docker."
    exit 1
fi

# –ó—É–ø–∏–Ω—è—î–º–æ —ñ—Å–Ω—É—é—á—ñ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏
echo "üõë –ó—É–ø–∏–Ω—è—î–º–æ —ñ—Å–Ω—É—é—á—ñ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏..."
docker-compose down 2>/dev/null || true

# –ó–∞–ø—É—Å–∫–∞—î–º–æ —Ç—ñ–ª—å–∫–∏ –±–∞–∑—É –¥–∞–Ω–∏—Ö
echo "üêò –ó–∞–ø—É—Å–∫–∞—î–º–æ PostgreSQL..."
docker-compose up -d db

# –ß–µ–∫–∞—î–º–æ –ø–æ–∫–∏ –±–∞–∑–∞ –¥–∞–Ω–∏—Ö –±—É–¥–µ –≥–æ—Ç–æ–≤–∞
echo "‚è≥ –ß–µ–∫–∞—î–º–æ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—ñ –±–∞–∑–∏ –¥–∞–Ω–∏—Ö..."
sleep 10

# –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ —Å—Ç–∞—Ç—É—Å
echo "üîç –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ —Å—Ç–∞—Ç—É—Å –±–∞–∑–∏ –¥–∞–Ω–∏—Ö..."
docker-compose ps

echo "‚úÖ PostgreSQL –±–∞–∑–∞ –¥–∞–Ω–∏—Ö –∑–∞–ø—É—â–µ–Ω–∞!"
echo "üìä URL: postgresql://postgres:postgres@localhost:5432/ai_swagger_bot"
echo ""
echo "üí° –î–ª—è –º—ñ–≥—Ä–∞—Ü—ñ—ó –ø—Ä–æ–º–ø—Ç—ñ–≤ –≤–∏–∫–æ–Ω–∞–π—Ç–µ:"
echo "   python scripts/migrate_to_postgres.py"
echo ""
echo "üí° –î–ª—è —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è –≤–∏–∫–æ–Ω–∞–π—Ç–µ:"
echo "   python cli_tester.py test-postgres-prompts"
