#!/bin/bash

# –°–∫—Ä–∏–ø—Ç –¥–ª—è –∑–∞–ø—É—Å–∫—É –ø–æ–∫—Ä–∞—â–µ–Ω–æ–≥–æ Streamlit —á–∞—Ç-–¥–æ–¥–∞—Ç–∫—É

echo "üí¨ AI Swagger Bot - –ó–∞–ø—É—Å–∫ –ø–æ–∫—Ä–∞—â–µ–Ω–æ–≥–æ —á–∞—Ç-—ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å—É"
echo "="*60

# –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ –Ω–∞—è–≤–Ω—ñ—Å—Ç—å conda
if ! command -v conda &> /dev/null; then
    echo "‚ùå –ü–æ–º–∏–ª–∫–∞: conda –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ"
    echo "üí° –í—Å—Ç–∞–Ω–æ–≤—ñ—Ç—å Miniconda –∞–±–æ Anaconda"
    exit 1
fi

# –ê–∫—Ç–∏–≤—É—î–º–æ conda —Å–µ—Ä–µ–¥–æ–≤–∏—â–µ
echo "üîß –ê–∫—Ç–∏–≤—É—î–º–æ conda —Å–µ—Ä–µ–¥–æ–≤–∏—â–µ..."
source $HOME/miniconda3/etc/profile.d/conda.sh
conda activate ai-swagger

# –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ –≤–µ—Ä—Å—ñ—é Python
echo "üêç –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ –≤–µ—Ä—Å—ñ—é Python..."
python --version

# –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ API –∫–ª—é—á
if [ -z "$OPENAI_API_KEY" ]; then
    echo "‚ö†Ô∏è  OPENAI_API_KEY –Ω–µ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ"
    echo "üí° –í—Å—Ç–∞–Ω–æ–≤—ñ—Ç—å –∑–º—ñ–Ω–Ω—É —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞ OPENAI_API_KEY"
    echo "   export OPENAI_API_KEY=your_api_key_here"
    exit 1
else
    echo "‚úÖ OpenAI API –∫–ª—é—á –∑–Ω–∞–π–¥–µ–Ω–æ"
fi

# –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ JWT —Ç–æ–∫–µ–Ω
if [ -z "$JWT_TOKEN" ]; then
    echo "‚ö†Ô∏è  JWT_TOKEN –Ω–µ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ"
    echo "üí° –í—Å—Ç–∞–Ω–æ–≤—ñ—Ç—å –∑–º—ñ–Ω–Ω—É —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞ JWT_TOKEN"
    echo "   export JWT_TOKEN=your_jwt_token_here"
else
    echo "‚úÖ JWT —Ç–æ–∫–µ–Ω –∑–Ω–∞–π–¥–µ–Ω–æ"
fi

# –û—á–∏—â—É—î–º–æ –±–∞–∑—É –¥–∞–Ω–∏—Ö –¥–ª—è —Å–≤—ñ–∂–∏—Ö –¥–∞–Ω–∏—Ö
echo "üßπ –û—á–∏—â–µ–Ω–Ω—è Chroma –±–∞–∑–∏ –¥–∞–Ω–∏—Ö –¥–ª—è —Å–≤—ñ–∂–∏—Ö –¥–∞–Ω–∏—Ö..."
python scripts/clear_chroma_db.py --auto

# –ü–µ—Ä–µ—ñ–Ω–¥–µ–∫—Å—É—î–º–æ Swagger —Ñ–∞–π–ª–∏
echo "üîÑ –ü–µ—Ä–µ—ñ–Ω–¥–µ–∫—Å–∞—Ü—ñ—è Swagger —Ñ–∞–π–ª—ñ–≤..."
python scripts/reindex_swagger.py

# –ó—É–ø–∏–Ω—è—î–º–æ –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ –ø—Ä–æ—Ü–µ—Å–∏ Streamlit
echo "üõë –ó—É–ø–∏–Ω—è—î–º–æ –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ –ø—Ä–æ—Ü–µ—Å–∏ Streamlit..."
pkill -f streamlit 2>/dev/null || true

# –ó–∞–ø—É—Å–∫–∞—î–º–æ –ø–æ–∫—Ä–∞—â–µ–Ω–∏–π Streamlit —á–∞—Ç-–¥–æ–¥–∞—Ç–æ–∫
echo "üöÄ –ó–∞–ø—É—Å–∫–∞—î–º–æ –ø–æ–∫—Ä–∞—â–µ–Ω–∏–π Streamlit —á–∞—Ç-–¥–æ–¥–∞—Ç–æ–∫..."
echo "üì± URL: http://localhost:8501"
echo "üåê Network URL: http://192.168.0.110:8501"
echo ""
echo "üí¨ –¶–µ –ø–æ–∫—Ä–∞—â–µ–Ω–∏–π —á–∞—Ç-—ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è InteractiveSwaggerAgent"
echo "ü§ñ –ü—ñ–¥—Ç—Ä–∏–º—É—î –ø–æ–≤–Ω–æ—Ü—ñ–Ω–Ω–∏–π –¥—ñ–∞–ª–æ–≥ –¥–ª—è –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è –ø–æ–º–∏–ª–æ–∫"
echo "üé® –ú–∞—î –ø–æ–∫—Ä–∞—â–µ–Ω–∏–π UI –∑—ñ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ—é —Ç–∞ –µ–∫—Å–ø–æ—Ä—Ç–æ–º"
echo ""
echo "‚ú® –û—Å–æ–±–ª–∏–≤–æ—Å—Ç—ñ –ø–æ–∫—Ä–∞—â–µ–Ω–æ–≥–æ —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å—É:"
echo "   ‚Ä¢ –ö—Ä–∞—Å–∏–≤–∏–π –≥—Ä–∞–¥—ñ—î–Ω—Ç–Ω–∏–π –∑–∞–≥–æ–ª–æ–≤–æ–∫"
echo "   ‚Ä¢ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —á–∞—Ç—É –≤ —Ä–µ–∞–ª—å–Ω–æ–º—É —á–∞—Å—ñ"
echo "   ‚Ä¢ –ï–∫—Å–ø–æ—Ä—Ç —ñ—Å—Ç–æ—Ä—ñ—ó —Ä–æ–∑–º–æ–≤–∏"
echo "   ‚Ä¢ –ü–æ–∫—Ä–∞—â–µ–Ω—ñ —Å—Ç–∏–ª—ñ —Ç–∞ –∞–Ω—ñ–º–∞—Ü—ñ—ó"
echo "   ‚Ä¢ –ü—ñ–¥–∫–∞–∑–∫–∏ –¥–ª—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞"
echo "   ‚Ä¢ –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –æ—á–∏—â–µ–Ω–Ω—è –ë–î –ø—Ä–∏ —Å—Ç–∞—Ä—Ç—ñ"
echo "   ‚Ä¢ –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∞ –ø–µ—Ä–µ—ñ–Ω–¥–µ–∫—Å–∞—Ü—ñ—è Swagger —Ñ–∞–π–ª—ñ–≤"
echo ""
echo "‚èπÔ∏è  –î–ª—è –∑—É–ø–∏–Ω–∫–∏ –Ω–∞—Ç–∏—Å–Ω—ñ—Ç—å Ctrl+C"

streamlit run enhanced_chat_app.py --server.port 8501
