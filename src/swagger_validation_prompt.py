"""
–ü—Ä–æ–º–ø—Ç –¥–ª—è –≤–∞–ª—ñ–¥–∞—Ü—ñ—ó —Ç–∞ –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è Swagger —Å–ø–µ—Ü–∏—Ñ—ñ–∫–∞—Ü—ñ—ó
"""

import json
from typing import Any, Dict, List, Optional


class SwaggerValidationPrompt:
    """–ö–ª–∞—Å –¥–ª—è –≤–∞–ª—ñ–¥–∞—Ü—ñ—ó —Ç–∞ –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è Swagger —Å–ø–µ—Ü–∏—Ñ—ñ–∫–∞—Ü—ñ—ó."""

    @staticmethod
    def get_swagger_validation_prompt(
        user_query: str, found_endpoints: List[Dict[str, Any]], api_response: Dict[str, Any] = None
    ) -> str:
        """–ü—Ä–æ–º–ø—Ç –¥–ª—è –≤–∞–ª—ñ–¥–∞—Ü—ñ—ó Swagger —Å–ø–µ—Ü–∏—Ñ—ñ–∫–∞—Ü—ñ—ó."""
        return f"""
–¢–∏ - –µ–∫—Å–ø–µ—Ä—Ç –∑ API —Ç–∞ Swagger/OpenAPI —Å–ø–µ—Ü–∏—Ñ—ñ–∫–∞—Ü—ñ—è–º–∏. –ü—Ä–æ–∞–Ω–∞–ª—ñ–∑—É–π —Å–∏—Ç—É–∞—Ü—ñ—é —Ç–∞ –≤–∏–ø—Ä–∞–≤ –ø–æ–º–∏–ª–∫–∏.

–ó–ê–ü–ò–¢ –ö–û–†–ò–°–¢–£–í–ê–ß–ê: {user_query}

–ó–ù–ê–ô–î–ï–ù–Ü ENDPOINTS:
{json.dumps(found_endpoints, ensure_ascii=False, indent=2)}

–í–Ü–î–ü–û–í–Ü–î–¨ API (—è–∫—â–æ —î):
{json.dumps(api_response, ensure_ascii=False, indent=2) if api_response else "–ù–µ–º–∞—î –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ"}

–ü–†–û–ë–õ–ï–ú–ò –Ø–ö–Ü –ú–û–ñ–£ –ë–£–¢–ò:
1. Swagger —Å–ø–µ—Ü–∏—Ñ—ñ–∫–∞—Ü—ñ—è –Ω–µ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—î —Ä–µ–∞–ª—å–Ω–æ–º—É API
2. –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ñ URL endpoints
3. –í—ñ–¥—Å—É—Ç–Ω—ñ endpoints –¥–ª—è –ø–µ–≤–Ω–∏—Ö –æ–ø–µ—Ä–∞—Ü—ñ–π
4. –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ñ HTTP –º–µ—Ç–æ–¥–∏
5. –ü–æ–º–∏–ª–∫–∏ –≤ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞—Ö

–ó–ê–í–î–ê–ù–ù–Ø:
1. –ü—Ä–æ–∞–Ω–∞–ª—ñ–∑—É–π –∑–∞–ø–∏—Ç –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
2. –ó–Ω–∞–π–¥–∏ –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–∏–π endpoint
3. –Ø–∫—â–æ endpoint –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∏–π - –∑–∞–ø—Ä–æ–ø–æ–Ω—É–π –ø—Ä–∞–≤–∏–ª—å–Ω–∏–π
4. –Ø–∫—â–æ endpoint –≤—ñ–¥—Å—É—Ç–Ω—ñ–π - –∑–∞–ø—Ä–æ–ø–æ–Ω—É–π –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—É
5. –ü–æ—è—Å–Ω–∏ –ø—Ä–æ–±–ª–µ–º—É –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—É

–í–Ü–î–ü–û–í–Ü–î–¨ –£ –§–û–†–ú–ê–¢–Ü:
{{
    "analysis": "–∞–Ω–∞–ª—ñ–∑ –ø—Ä–æ–±–ª–µ–º–∏",
    "correct_endpoint": "–ø—Ä–∞–≤–∏–ª—å–Ω–∏–π endpoint",
    "suggestion": "–ø—Ä–æ–ø–æ–∑–∏—Ü—ñ—è –¥–ª—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞",
    "swagger_issue": "–ø—Ä–æ–±–ª–µ–º–∞ –≤ Swagger —Å–ø–µ—Ü–∏—Ñ—ñ–∫–∞—Ü—ñ—ó",
    "user_message": "–ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –¥–ª—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞"
}}
"""

    @staticmethod
    def get_endpoint_correction_prompt(
        user_query: str, incorrect_endpoint: Dict[str, Any], api_error: Dict[str, Any]
    ) -> str:
        """–ü—Ä–æ–º–ø—Ç –¥–ª—è –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ endpoint."""
        return f"""
–¢–∏ - –µ–∫—Å–ø–µ—Ä—Ç –∑ API. –í–∏–ø—Ä–∞–≤ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∏–π endpoint –Ω–∞ –æ—Å–Ω–æ–≤—ñ –ø–æ–º–∏–ª–∫–∏ —Å–µ—Ä–≤–µ—Ä–∞.

–ó–ê–ü–ò–¢ –ö–û–†–ò–°–¢–£–í–ê–ß–ê: {user_query}

–ù–ï–ü–†–ê–í–ò–õ–¨–ù–ò–ô ENDPOINT:
{json.dumps(incorrect_endpoint, ensure_ascii=False, indent=2)}

–ü–û–ú–ò–õ–ö–ê –°–ï–†–í–ï–†–ê:
{json.dumps(api_error, ensure_ascii=False, indent=2)}

–ê–ù–ê–õ–Ü–ó –ü–û–ú–ò–õ–ö–ò:
- –ü–æ–º–∏–ª–∫–∞: "invalid input syntax for type uuid: "{id}""
- –¶–µ –æ–∑–Ω–∞—á–∞—î —â–æ endpoint –æ—á—ñ–∫—É—î UUID –ø–∞—Ä–∞–º–µ—Ç—Ä, –∞–ª–µ –æ—Ç—Ä–∏–º—É—î "{id}"
- –ú–æ–∂–ª–∏–≤–æ —Ü–µ endpoint –¥–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ—ó –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó, –∞ –Ω–µ –≤—Å—ñ—Ö

–ó–ê–í–î–ê–ù–ù–Ø:
1. –í–∏–∑–Ω–∞—á–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–∏–π endpoint –¥–ª—è –∑–∞–ø–∏—Ç—É
2. –Ø–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ –æ—Ç—Ä–∏–º–∞—Ç–∏ –≤—Å—ñ –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó - –∑–Ω–∞–π–¥–∏ endpoint –±–µ–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä—ñ–≤
3. –Ø–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ –æ—Ç—Ä–∏–º–∞—Ç–∏ –æ–¥–Ω—É –∫–∞—Ç–µ–≥–æ—Ä—ñ—é - –≤–∏–ø—Ä–∞–≤ –ø–∞—Ä–∞–º–µ—Ç—Ä
4. –ü–æ—è—Å–Ω–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—É —â–æ –≤—ñ–¥–±—É–≤–∞—î—Ç—å—Å—è

–í–Ü–î–ü–û–í–Ü–î–¨ –£ –§–û–†–ú–ê–¢–Ü:
{{
    "correct_endpoint": "–ø—Ä–∞–≤–∏–ª—å–Ω–∏–π endpoint",
    "explanation": "–ø–æ—è—Å–Ω–µ–Ω–Ω—è –ø—Ä–æ–±–ª–µ–º–∏",
    "user_message": "–ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –¥–ª—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞",
    "retry_suggestion": "–ø—Ä–æ–ø–æ–∑–∏—Ü—ñ—è –¥–ª—è –ø–æ–≤—Ç–æ—Ä–Ω–æ—ó —Å–ø—Ä–æ–±–∏"
}}
"""

    @staticmethod
    def get_swagger_mismatch_prompt(
        user_query: str, swagger_endpoints: List[Dict[str, Any]], api_error: Dict[str, Any] = None
    ) -> str:
        """–ü—Ä–æ–º–ø—Ç –¥–ª—è –æ–±—Ä–æ–±–∫–∏ —Å–∏—Ç—É–∞—Ü—ñ–π –∫–æ–ª–∏ Swagger —Å–ø–µ—Ü–∏—Ñ—ñ–∫–∞—Ü—ñ—è –Ω–µ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—î —Ä–µ–∞–ª—å–Ω–æ–º—É API."""
        return f"""
–¢–∏ - –µ–∫—Å–ø–µ—Ä—Ç –∑ API. –û–±—Ä–æ–±–∏ —Å–∏—Ç—É–∞—Ü—ñ—é –∫–æ–ª–∏ Swagger —Å–ø–µ—Ü–∏—Ñ—ñ–∫–∞—Ü—ñ—è –Ω–µ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—î —Ä–µ–∞–ª—å–Ω–æ–º—É API.

–ó–ê–ü–ò–¢ –ö–û–†–ò–°–¢–£–í–ê–ß–ê: {user_query}

ENDPOINTS –ó SWAGGER –°–ü–ï–¶–ò–§–Ü–ö–ê–¶–Ü–á:
{json.dumps(swagger_endpoints, ensure_ascii=False, indent=2)}

–ü–û–ú–ò–õ–ö–ê API (—è–∫—â–æ —î):
{json.dumps(api_error, ensure_ascii=False, indent=2) if api_error else "–ù–µ–º–∞—î –ø–æ–º–∏–ª–∫–∏"}

–¢–ò–ü–û–í–Ü –ü–†–û–ë–õ–ï–ú–ò:
1. Endpoint –º–∞—î –ø–∞—Ä–∞–º–µ—Ç—Ä {{id}} –∑–∞–º—ñ—Å—Ç—å –±—É—Ç–∏ –±–µ–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä—ñ–≤
2. –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞ –Ω–∞–∑–≤–∞ —Ä–µ—Å—É—Ä—Å—É (category –∑–∞–º—ñ—Å—Ç—å categories)
3. –í—ñ–¥—Å—É—Ç–Ω—ñ–π endpoint –¥–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –≤—Å—ñ—Ö –∑–∞–ø–∏—Å—ñ–≤
4. –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∏–π HTTP –º–µ—Ç–æ–¥

–ê–ù–ê–õ–Ü–ó –ó–ê–ü–ò–¢–£:
- "–ü–æ–∫–∞–∂–∏ –≤—Å—ñ –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó" = GET –±–µ–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä—ñ–≤
- "–ü–æ–∫–∞–∂–∏ –∫–∞—Ç–µ–≥–æ—Ä—ñ—é –∑ ID" = GET –∑ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º
- "–°—Ç–≤–æ—Ä–∏ –∫–∞—Ç–µ–≥–æ—Ä—ñ—é" = POST
- "–û–Ω–æ–≤–∏ –∫–∞—Ç–µ–≥–æ—Ä—ñ—é" = PUT/PATCH
- "–í–∏–¥–∞–ª–∏ –∫–∞—Ç–µ–≥–æ—Ä—ñ—é" = DELETE

–ó–ê–í–î–ê–ù–ù–Ø:
1. –ü—Ä–æ–∞–Ω–∞–ª—ñ–∑—É–π —â–æ —Ö–æ—á–µ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á
2. –ó–Ω–∞–π–¥–∏ –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–∏–π endpoint –≤ Swagger
3. –Ø–∫—â–æ endpoint –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∏–π - –∑–∞–ø—Ä–æ–ø–æ–Ω—É–π –ø—Ä–∞–≤–∏–ª—å–Ω–∏–π
4. –Ø–∫—â–æ endpoint –≤—ñ–¥—Å—É—Ç–Ω—ñ–π - —Å—Ç–≤–æ—Ä–∏ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—É
5. –ü–æ—è—Å–Ω–∏ –ø—Ä–æ–±–ª–µ–º—É –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—É

–ü–†–ê–í–ò–õ–ê –í–ò–ü–†–ê–í–õ–ï–ù–ù–Ø:
- –î–ª—è "–≤—Å—ñ –∑–∞–ø–∏—Å–∏" –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π GET /api/{resource} (–±–µ–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä—ñ–≤)
- –î–ª—è "–∫–æ–Ω–∫—Ä–µ—Ç–Ω–∏–π –∑–∞–ø–∏—Å" –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π GET /api/{resource}/{id}
- –î–ª—è "—Å—Ç–≤–æ—Ä–µ–Ω–Ω—è" –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π POST /api/{resource}
- –î–ª—è "–æ–Ω–æ–≤–ª–µ–Ω–Ω—è" –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π PUT /api/{resource}/{id}
- –î–ª—è "–≤–∏–¥–∞–ª–µ–Ω–Ω—è" –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π DELETE /api/{resource}/{id}

–í–Ü–î–ü–û–í–Ü–î–¨ –£ –§–û–†–ú–ê–¢–Ü:
{{
    "user_intent": "—â–æ —Ö–æ—á–µ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á",
    "swagger_issue": "–ø—Ä–æ–±–ª–µ–º–∞ –≤ Swagger —Å–ø–µ—Ü–∏—Ñ—ñ–∫–∞—Ü—ñ—ó",
    "correct_endpoint": "–ø—Ä–∞–≤–∏–ª—å–Ω–∏–π endpoint",
    "alternative_endpoints": ["–∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ñ endpoints"],
    "explanation": "–ø–æ—è—Å–Ω–µ–Ω–Ω—è –ø—Ä–æ–±–ª–µ–º–∏",
    "user_message": "–ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –¥–ª—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞",
    "suggestion": "–ø—Ä–æ–ø–æ–∑–∏—Ü—ñ—è –¥–ª—è –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è"
}}
"""

    @staticmethod
    def get_endpoint_discovery_prompt(
        user_query: str, available_endpoints: List[Dict[str, Any]]
    ) -> str:
        """–ü—Ä–æ–º–ø—Ç –¥–ª—è –ø–æ—à—É–∫—É –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ endpoint –∫–æ–ª–∏ Swagger —Å–ø–µ—Ü–∏—Ñ—ñ–∫–∞—Ü—ñ—è –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞."""
        return f"""
–¢–∏ - –µ–∫—Å–ø–µ—Ä—Ç –∑ API. –ó–Ω–∞–π–¥–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–∏–π endpoint –∫–æ–ª–∏ Swagger —Å–ø–µ—Ü–∏—Ñ—ñ–∫–∞—Ü—ñ—è –Ω–µ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—î —Ä–µ–∞–ª—å–Ω–æ–º—É API.

–ó–ê–ü–ò–¢ –ö–û–†–ò–°–¢–£–í–ê–ß–ê: {user_query}

–î–û–°–¢–£–ü–ù–Ü ENDPOINTS:
{json.dumps(available_endpoints, ensure_ascii=False, indent=2)}

–ó–ê–í–î–ê–ù–ù–Ø:
1. –ü—Ä–æ–∞–Ω–∞–ª—ñ–∑—É–π –∑–∞–ø–∏—Ç –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
2. –í–∏–∑–Ω–∞—á–∏ —Ç–∏–ø –æ–ø–µ—Ä–∞—Ü—ñ—ó (GET, POST, PUT, DELETE)
3. –í–∏–∑–Ω–∞—á–∏ —Ä–µ—Å—É—Ä—Å (–∫–∞—Ç–µ–≥–æ—Ä—ñ—ó, —Ç–æ–≤–∞—Ä–∏, –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ, —Ç–æ—â–æ)
4. –ó–Ω–∞–π–¥–∏ –Ω–∞–π–±—ñ–ª—å—à –ø—ñ–¥—Ö–æ–¥—è—â–∏–π endpoint
5. –Ø–∫—â–æ —Ç–æ—á–Ω–æ–≥–æ endpoint –Ω–µ–º–∞—î - –∑–∞–ø—Ä–æ–ø–æ–Ω—É–π –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—É

–ü–†–ê–í–ò–õ–ê –ü–û–®–£–ö–£:
- "–≤—Å—ñ –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó" ‚Üí —à—É–∫–∞–π GET –±–µ–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä—ñ–≤
- "–∫–∞—Ç–µ–≥–æ—Ä—ñ—è –∑ ID" ‚Üí —à—É–∫–∞–π GET –∑ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º
- "—Å—Ç–≤–æ—Ä–∏ –∫–∞—Ç–µ–≥–æ—Ä—ñ—é" ‚Üí —à—É–∫–∞–π POST
- "–æ–Ω–æ–≤–∏ –∫–∞—Ç–µ–≥–æ—Ä—ñ—é" ‚Üí —à—É–∫–∞–π PUT/PATCH
- "–≤–∏–¥–∞–ª–∏ –∫–∞—Ç–µ–≥–æ—Ä—ñ—é" ‚Üí —à—É–∫–∞–π DELETE

–ê–õ–¨–¢–ï–†–ù–ê–¢–ò–í–ù–Ü –ù–ê–ó–í–ò –†–ï–°–£–†–°–Ü–í:
- category/categories
- product/products
- user/users
- order/orders
- item/items

–í–Ü–î–ü–û–í–Ü–î–¨ –£ –§–û–†–ú–ê–¢–Ü:
{{
    "user_intent": "—â–æ —Ö–æ—á–µ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á",
    "operation_type": "GET|POST|PUT|DELETE",
    "resource": "–Ω–∞–∑–≤–∞ —Ä–µ—Å—É—Ä—Å—É",
    "best_match": "–Ω–∞–π–∫—Ä–∞—â–∏–π endpoint",
    "alternatives": ["–∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ñ endpoints"],
    "confidence": "–≤—ñ–¥—Å–æ—Ç–æ–∫ –≤–ø–µ–≤–Ω–µ–Ω–æ—Å—Ç—ñ",
    "reasoning": "–ø–æ—è—Å–Ω–µ–Ω–Ω—è –≤–∏–±–æ—Ä—É"
}}
"""

    @staticmethod
    def get_swagger_retry_prompt(
        user_query: str, original_endpoint: Dict[str, Any], corrected_endpoint: Dict[str, Any]
    ) -> str:
        """–ü—Ä–æ–º–ø—Ç –¥–ª—è –ø–æ–≤—Ç–æ—Ä–Ω–æ—ó —Å–ø—Ä–æ–±–∏ –∑ –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–∏–º endpoint."""
        return f"""
–¢–∏ - –µ–∫—Å–ø–µ—Ä—Ç –∑ API. –í–∏–∫–æ–Ω–∞–π –ø–æ–≤—Ç–æ—Ä–Ω—É —Å–ø—Ä–æ–±—É –∑ –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–∏–º endpoint.

–ó–ê–ü–ò–¢ –ö–û–†–ò–°–¢–£–í–ê–ß–ê: {user_query}

–û–†–ò–ì–Ü–ù–ê–õ–¨–ù–ò–ô ENDPOINT (–Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∏–π):
{json.dumps(original_endpoint, ensure_ascii=False, indent=2)}

–í–ò–ü–†–ê–í–õ–ï–ù–ò–ô ENDPOINT:
{json.dumps(corrected_endpoint, ensure_ascii=False, indent=2)}

–ó–ê–í–î–ê–ù–ù–Ø:
1. –í–∏–∫–æ–Ω–∞–π –∑–∞–ø–∏—Ç –∑ –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–∏–º endpoint
2. –Ø–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ - –∑–º—ñ–Ω–∏ HTTP –º–µ—Ç–æ–¥
3. –Ø–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ - –¥–æ–¥–∞–π –∞–±–æ –≤–∏–¥–∞–ª–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏
4. –ü–æ–≤–µ—Ä–Ω–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—É

–ü–†–ê–í–ò–õ–ê –í–ò–ü–†–ê–í–õ–ï–ù–ù–Ø:
- –î–ª—è "–≤—Å—ñ –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó" –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π GET –±–µ–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä—ñ–≤
- –î–ª—è "–∫–æ–Ω–∫—Ä–µ—Ç–Ω–∞ –∫–∞—Ç–µ–≥–æ—Ä—ñ—è" –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π GET –∑ ID
- –î–ª—è "—Å—Ç–≤–æ—Ä–µ–Ω–Ω—è" –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π POST
- –î–ª—è "–æ–Ω–æ–≤–ª–µ–Ω–Ω—è" –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π PUT/PATCH
- –î–ª—è "–≤–∏–¥–∞–ª–µ–Ω–Ω—è" –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π DELETE

–í–Ü–î–ü–û–í–Ü–î–¨ –£ –§–û–†–ú–ê–¢–Ü:
{{
    "corrected_request": "–≤–∏–ø—Ä–∞–≤–ª–µ–Ω–∏–π –∑–∞–ø–∏—Ç",
    "expected_response": "–æ—á—ñ–∫—É–≤–∞–Ω–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥—å",
    "user_message": "–ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –¥–ª—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞"
}}
"""

    @staticmethod
    def get_common_endpoint_patterns() -> Dict[str, str]:
        """–ü–æ–≤–µ—Ä—Ç–∞—î –∑–∞–≥–∞–ª—å–Ω—ñ –ø–∞—Ç–µ—Ä–Ω–∏ endpoints."""
        return {
            "get_all": {
                "pattern": "GET /api/{resource}",
                "example": "GET /api/categories",
                "description": "–û—Ç—Ä–∏–º–∞–Ω–Ω—è –≤—Å—ñ—Ö –∑–∞–ø–∏—Å—ñ–≤",
            },
            "get_by_id": {
                "pattern": "GET /api/{resource}/{id}",
                "example": "GET /api/categories/123",
                "description": "–û—Ç—Ä–∏–º–∞–Ω–Ω—è –∑–∞–ø–∏—Å—É –∑–∞ ID",
            },
            "create": {
                "pattern": "POST /api/{resource}",
                "example": "POST /api/categories",
                "description": "–°—Ç–≤–æ—Ä–µ–Ω–Ω—è –Ω–æ–≤–æ–≥–æ –∑–∞–ø–∏—Å—É",
            },
            "update": {
                "pattern": "PUT /api/{resource}/{id}",
                "example": "PUT /api/categories/123",
                "description": "–û–Ω–æ–≤–ª–µ–Ω–Ω—è –∑–∞–ø–∏—Å—É",
            },
            "delete": {
                "pattern": "DELETE /api/{resource}/{id}",
                "example": "DELETE /api/categories/123",
                "description": "–í–∏–¥–∞–ª–µ–Ω–Ω—è –∑–∞–ø–∏—Å—É",
            },
        }

    @staticmethod
    def get_swagger_issues_detection_prompt(swagger_spec: Dict[str, Any]) -> str:
        """–ü—Ä–æ–º–ø—Ç –¥–ª—è –≤–∏—è–≤–ª–µ–Ω–Ω—è –ø—Ä–æ–±–ª–µ–º —É Swagger —Å–ø–µ—Ü–∏—Ñ—ñ–∫–∞—Ü—ñ—ó."""
        return f"""
–¢–∏ - –µ–∫—Å–ø–µ—Ä—Ç –∑ API. –ü—Ä–æ–∞–Ω–∞–ª—ñ–∑—É–π Swagger —Å–ø–µ—Ü–∏—Ñ—ñ–∫–∞—Ü—ñ—é —Ç–∞ –≤–∏—è–≤–∏ –ø—Ä–æ–±–ª–µ–º–∏.

SWAGGER –°–ü–ï–¶–ò–§–Ü–ö–ê–¶–Ü–Ø:
{json.dumps(swagger_spec, ensure_ascii=False, indent=2)}

–ó–ê–í–î–ê–ù–ù–Ø:
1. –ó–Ω–∞–π–¥–∏ endpoints —è–∫—ñ –Ω–µ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—é—Ç—å RESTful –ø—Ä–∏–Ω—Ü–∏–ø–∞–º
2. –í–∏—è–≤–∏ –≤—ñ–¥—Å—É—Ç–Ω—ñ endpoints –¥–ª—è –±–∞–∑–æ–≤–∏—Ö –æ–ø–µ—Ä–∞—Ü—ñ–π
3. –ü–µ—Ä–µ–≤—ñ—Ä –ø—Ä–∞–≤–∏–ª—å–Ω—ñ—Å—Ç—å HTTP –º–µ—Ç–æ–¥—ñ–≤
4. –ó–Ω–∞–π–¥–∏ –ø—Ä–æ–±–ª–µ–º–∏ –∑ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
5. –ó–∞–ø—Ä–æ–ø–æ–Ω—É–π –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è

–¢–ò–ü–û–í–Ü –ü–†–û–ë–õ–ï–ú–ò:
- –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ñ URL (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, /api/category –∑–∞–º—ñ—Å—Ç—å /api/categories)
- –í—ñ–¥—Å—É—Ç–Ω—ñ endpoints –¥–ª—è CRUD –æ–ø–µ—Ä–∞—Ü—ñ–π
- –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ñ HTTP –º–µ—Ç–æ–¥–∏
- –ü—Ä–æ–±–ª–µ–º–∏ –∑ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, {id} –∑–∞–º—ñ—Å—Ç—å —Ä–µ–∞–ª—å–Ω–æ–≥–æ ID)

–í–Ü–î–ü–û–í–Ü–î–¨ –£ –§–û–†–ú–ê–¢–Ü:
{{
    "issues": [
        {{
            "type": "—Ç–∏–ø –ø—Ä–æ–±–ª–µ–º–∏",
            "description": "–æ–ø–∏—Å –ø—Ä–æ–±–ª–µ–º–∏",
            "endpoint": "–ø—Ä–æ–±–ª–µ–º–Ω–∏–π endpoint",
            "suggestion": "–ø—Ä–æ–ø–æ–∑–∏—Ü—ñ—è –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è"
        }}
    ],
    "missing_endpoints": [
        {{
            "operation": "–≤—ñ–¥—Å—É—Ç–Ω—è –æ–ø–µ—Ä–∞—Ü—ñ—è",
            "suggested_endpoint": "–∑–∞–ø—Ä–æ–ø–æ–Ω–æ–≤–∞–Ω–∏–π endpoint"
        }}
    ],
    "recommendations": "–∑–∞–≥–∞–ª—å–Ω—ñ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó"
}}
"""


# –ü—Ä–∏–∫–ª–∞–¥–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è
if __name__ == "__main__":
    # –ü—Ä–∏–∫–ª–∞–¥ –ø—Ä–æ–±–ª–µ–º–Ω–æ—ó —Å–∏—Ç—É–∞—Ü—ñ—ó
    user_query = "–ü–æ–∫–∞–∂–∏ –≤—Å—ñ –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó"

    found_endpoints = [
        {
            "url": "https://db62d2b2c3a5.ngrok-free.app/api/category/{id}",
            "method": "GET",
            "description": "Get a category by ID (Public)",
        }
    ]

    api_error = {
        "message": 'invalid input syntax for type uuid: "{id}"',
        "error": "Bad Request",
        "statusCode": 400,
    }

    # –ì–µ–Ω–µ—Ä—É—î–º–æ –ø—Ä–æ–º–ø—Ç –¥–ª—è –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è
    validation_prompt = SwaggerValidationPrompt.get_swagger_validation_prompt(
        user_query, found_endpoints, api_error
    )

    print("üîç –ü—Ä–æ–º–ø—Ç –¥–ª—è –≤–∞–ª—ñ–¥–∞—Ü—ñ—ó Swagger:")
    print(validation_prompt)
    print()

    # –ì–µ–Ω–µ—Ä—É—î–º–æ –ø—Ä–æ–º–ø—Ç –¥–ª—è –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è endpoint
    correction_prompt = SwaggerValidationPrompt.get_endpoint_correction_prompt(
        user_query, found_endpoints[0], api_error
    )

    print("üîß –ü—Ä–æ–º–ø—Ç –¥–ª—è –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è endpoint:")
    print(correction_prompt)
    print()

    # –ì–µ–Ω–µ—Ä—É—î–º–æ –ø—Ä–æ–º–ø—Ç –¥–ª—è –æ–±—Ä–æ–±–∫–∏ –Ω–µ–≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–æ—Å—Ç—ñ Swagger
    mismatch_prompt = SwaggerValidationPrompt.get_swagger_mismatch_prompt(
        user_query, found_endpoints, api_error
    )

    print("‚ö†Ô∏è –ü—Ä–æ–º–ø—Ç –¥–ª—è –æ–±—Ä–æ–±–∫–∏ –Ω–µ–≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–æ—Å—Ç—ñ Swagger:")
    print(mismatch_prompt)
    print()

    print("‚úÖ –ü—Ä–æ–º–ø—Ç–∏ –≥–æ—Ç–æ–≤—ñ –¥–ª—è –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –≤ InteractiveSwaggerAgent!")
